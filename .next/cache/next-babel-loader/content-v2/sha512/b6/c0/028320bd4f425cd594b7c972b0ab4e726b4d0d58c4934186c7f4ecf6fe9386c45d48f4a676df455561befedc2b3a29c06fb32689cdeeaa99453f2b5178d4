{"ast":null,"code":"import _defineProperty from \"/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { initAuth0 } from '@auth0/nextjs-auth0';\nvar auth0 = initAuth0({\n  domain: process.env.AUTH0_DOMAIN,\n  clientId: process.env.AUTH0_CLIENTID,\n  clientSecret: process.env.AUTH0_CLIENTSECRET,\n  scope: 'openid profile',\n  redirectUri: process.env.AUTH0_REDIRECT_URI,\n  postLogoutRedirectUri: process.env.AUTH0_POSTLOGOUT_REDIRECT_URI,\n  session: {\n    cookieSecret: process.env.AUTH0_COOKIE_SECRET\n  }\n});\nexport default auth0;\nexport var isAuthorized = function isAuthorized(user, role) {\n  return user && user[process.env.AUTH0_NAMESPACE + '/roles'].includes(role);\n};\nexport var authorizeUser = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(req, res) {\n    var session;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return auth0.getSession(req);\n\n          case 2:\n            session = _context.sent;\n\n            if (!(!session || !session.user)) {\n              _context.next = 7;\n              break;\n            }\n\n            res.writeHead(302, {\n              Location: '/api/v1/login'\n            });\n            res.end();\n            return _context.abrupt(\"return\", null);\n\n          case 7:\n            return _context.abrupt(\"return\", session.user);\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function authorizeUser(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var withAuth = function withAuth(getData) {\n  return function (role) {\n    return /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref2) {\n        var req, res, session, data;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                req = _ref2.req, res = _ref2.res;\n                _context2.next = 3;\n                return auth0.getSession(req);\n\n              case 3:\n                session = _context2.sent;\n\n                if (!(!session || !session.user || role && !isAuthorized(session.user, role))) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                res.writeHead(302, {\n                  Location: '/api/v1/login'\n                });\n                res.end();\n                return _context2.abrupt(\"return\", {\n                  props: {}\n                });\n\n              case 8:\n                if (!getData) {\n                  _context2.next = 14;\n                  break;\n                }\n\n                _context2.next = 11;\n                return getData({\n                  req: req,\n                  res: res\n                }, session.user);\n\n              case 11:\n                _context2.t0 = _context2.sent;\n                _context2.next = 15;\n                break;\n\n              case 14:\n                _context2.t0 = {};\n\n              case 15:\n                data = _context2.t0;\n                return _context2.abrupt(\"return\", {\n                  props: _objectSpread({\n                    user: session.user\n                  }, data)\n                });\n\n              case 17:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n  };\n};","map":null,"metadata":{},"sourceType":"module"}