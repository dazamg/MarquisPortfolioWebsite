{"ast":null,"code":"import _defineProperty from \"/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { initAuth0 } from '@auth0/nextjs-auth0';\nvar auth0 = initAuth0({\n  domain: process.env.AUTH0_DOMAIN,\n  clientId: process.env.AUTH0_CLIENTID,\n  clientSecret: process.env.AUTH0_CLIENTSECRET,\n  scope: 'openid profile',\n  redirectUri: process.env.AUTH0_REDIRECT_URI,\n  postLogoutRedirectUri: process.env.AUTH0_POSTLOGOUT_REDIRECT_URI,\n  session: {\n    cookieSecret: process.env.AUTH0_COOKIE_SECRET\n  }\n});\nexport default auth0;\nexport var isAuthorized = function isAuthorized(user, role) {\n  console.log(user);\n  return user && user[process.env.AUTH0_NAMESPACE + '/roles'].includes(role);\n};\nexport var authorizeUser = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(req, res) {\n    var session;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return auth0.getSession(req);\n\n          case 2:\n            session = _context.sent;\n\n            if (!(!session || !session.user)) {\n              _context.next = 7;\n              break;\n            }\n\n            res.writeHead(302, {\n              Location: '/api/v1/login'\n            });\n            res.end();\n            return _context.abrupt(\"return\", null);\n\n          case 7:\n            return _context.abrupt(\"return\", session.user);\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function authorizeUser(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var withAuth = function withAuth(getData) {\n  return /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref2) {\n      var req, res, session, data;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              req = _ref2.req, res = _ref2.res;\n              _context2.next = 3;\n              return auth0.getSession(req);\n\n            case 3:\n              session = _context2.sent;\n\n              if (!(!session || !session.user)) {\n                _context2.next = 8;\n                break;\n              }\n\n              res.writeHead(302, {\n                Location: '/api/v1/login'\n              });\n              res.end();\n              return _context2.abrupt(\"return\", {\n                props: {}\n              });\n\n            case 8:\n              if (!getData) {\n                _context2.next = 14;\n                break;\n              }\n\n              _context2.next = 11;\n              return getData({\n                req: req,\n                res: res\n              }, session.user);\n\n            case 11:\n              _context2.t0 = _context2.sent;\n              _context2.next = 15;\n              break;\n\n            case 14:\n              _context2.t0 = {};\n\n            case 15:\n              data = _context2.t0;\n              return _context2.abrupt(\"return\", {\n                props: _objectSpread({\n                  user: session.user\n                }, data)\n              });\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n};","map":{"version":3,"sources":["/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/utils/auth0.js"],"names":["initAuth0","auth0","domain","process","env","AUTH0_DOMAIN","clientId","AUTH0_CLIENTID","clientSecret","AUTH0_CLIENTSECRET","scope","redirectUri","AUTH0_REDIRECT_URI","postLogoutRedirectUri","AUTH0_POSTLOGOUT_REDIRECT_URI","session","cookieSecret","AUTH0_COOKIE_SECRET","isAuthorized","user","role","console","log","AUTH0_NAMESPACE","includes","authorizeUser","req","res","getSession","writeHead","Location","end","withAuth","getData","props","data"],"mappings":";;;;;;;;AAAA,SAASA,SAAT,QAA0B,qBAA1B;AAKA,IAAMC,KAAK,GAAGD,SAAS,CAAC;AACtBE,EAAAA,MAAM,EAAEC,OAAO,CAACC,GAAR,CAAYC,YADE;AAEtBC,EAAAA,QAAQ,EAAEH,OAAO,CAACC,GAAR,CAAYG,cAFA;AAGtBC,EAAAA,YAAY,EAAEL,OAAO,CAACC,GAAR,CAAYK,kBAHJ;AAItBC,EAAAA,KAAK,EAAE,gBAJe;AAKtBC,EAAAA,WAAW,EAAER,OAAO,CAACC,GAAR,CAAYQ,kBALH;AAMtBC,EAAAA,qBAAqB,EAAEV,OAAO,CAACC,GAAR,CAAYU,6BANb;AAOtBC,EAAAA,OAAO,EAAE;AACPC,IAAAA,YAAY,EAAEb,OAAO,CAACC,GAAR,CAAYa;AADnB;AAPa,CAAD,CAAvB;AAYA,eAAehB,KAAf;AAEA,OAAO,IAAMiB,YAAY,GAAG,SAAfA,YAAe,CAACC,IAAD,EAAOC,IAAP,EAAgB;AAC1CC,EAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ;AACA,SAAOA,IAAI,IAAIA,IAAI,CAAChB,OAAO,CAACC,GAAR,CAAYmB,eAAZ,GAA8B,QAA/B,CAAJ,CAA6CC,QAA7C,CAAsDJ,IAAtD,CAAf;AACD,CAHM;AAKP,OAAO,IAAMK,aAAa;AAAA,sEAAG,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACL1B,KAAK,CAAC2B,UAAN,CAAiBF,GAAjB,CADK;;AAAA;AACrBX,YAAAA,OADqB;;AAAA,kBAEvB,CAACA,OAAD,IAAY,CAACA,OAAO,CAACI,IAFE;AAAA;AAAA;AAAA;;AAGzBQ,YAAAA,GAAG,CAACE,SAAJ,CAAc,GAAd,EAAmB;AACjBC,cAAAA,QAAQ,EAAE;AADO,aAAnB;AAGAH,YAAAA,GAAG,CAACI,GAAJ;AANyB,6CAOlB,IAPkB;;AAAA;AAAA,6CAUpBhB,OAAO,CAACI,IAVY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAbM,aAAa;AAAA;AAAA;AAAA,GAAnB;AAaP,OAAO,IAAMO,QAAQ,GAAG,SAAXA,QAAW,CAACC,OAAD;AAAA;AAAA,yEAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAQP,cAAAA,GAAR,SAAQA,GAAR,EAAaC,GAAb,SAAaA,GAAb;AAAA;AAAA,qBACb1B,KAAK,CAAC2B,UAAN,CAAiBF,GAAjB,CADa;;AAAA;AAC7BX,cAAAA,OAD6B;;AAAA,oBAE/B,CAACA,OAAD,IAAY,CAACA,OAAO,CAACI,IAFU;AAAA;AAAA;AAAA;;AAGjCQ,cAAAA,GAAG,CAACE,SAAJ,CAAc,GAAd,EAAmB;AACjBC,gBAAAA,QAAQ,EAAE;AADO,eAAnB;AAGAH,cAAAA,GAAG,CAACI,GAAJ;AANiC,gDAO1B;AAACG,gBAAAA,KAAK,EAAE;AAAR,eAP0B;;AAAA;AAAA,mBAUtBD,OAVsB;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAUNA,OAAO,CAAC;AAACP,gBAAAA,GAAG,EAAHA,GAAD;AAAMC,gBAAAA,GAAG,EAAHA;AAAN,eAAD,EAAaZ,OAAO,CAACI,IAArB,CAVD;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,6BAU8B,EAV9B;;AAAA;AAU7BgB,cAAAA,IAV6B;AAAA,gDAY5B;AAACD,gBAAAA,KAAK;AAAGf,kBAAAA,IAAI,EAAEJ,OAAO,CAACI;AAAjB,mBAA0BgB,IAA1B;AAAN,eAZ4B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAb;;AAAA;AAAA;AAAA;AAAA;AAAA,CAAjB","sourcesContent":["import { initAuth0 } from '@auth0/nextjs-auth0';\n\n\n\n\nconst auth0 = initAuth0({\n  domain: process.env.AUTH0_DOMAIN,\n  clientId: process.env.AUTH0_CLIENTID,\n  clientSecret: process.env.AUTH0_CLIENTSECRET,\n  scope: 'openid profile',\n  redirectUri: process.env.AUTH0_REDIRECT_URI,\n  postLogoutRedirectUri: process.env.AUTH0_POSTLOGOUT_REDIRECT_URI,\n  session: {\n    cookieSecret: process.env.AUTH0_COOKIE_SECRET,\n  },\n});\n\nexport default auth0\n\nexport const isAuthorized = (user, role) => {\n  console.log(user) \n  return(user && user[process.env.AUTH0_NAMESPACE + '/roles'].includes(role))\n}\n\nexport const authorizeUser = async (req, res) => {\n  const session = await auth0.getSession(req);\n  if (!session || !session.user) {\n    res.writeHead(302, {\n      Location: '/api/v1/login'\n    });\n    res.end();\n    return null;\n  }\n\n  return session.user;\n}\n\nexport const withAuth = (getData) => async ({req, res}) => {\n  const session = await auth0.getSession(req);\n  if (!session || !session.user) {\n    res.writeHead(302, {\n      Location: '/api/v1/login'\n    });\n    res.end();\n    return {props: {}};\n  }\n\n  const data = getData ? await getData({req, res}, session.user) : {};\n\n  return {props: {user: session.user, ...data}}\n}"]},"metadata":{},"sourceType":"module"}