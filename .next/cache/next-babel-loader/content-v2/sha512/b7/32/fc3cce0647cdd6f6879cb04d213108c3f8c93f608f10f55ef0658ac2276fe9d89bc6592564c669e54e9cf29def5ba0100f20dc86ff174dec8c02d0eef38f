{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { initAuth0 } from '@auth0/nextjs-auth0';\nconst auth0 = initAuth0({\n  domain: process.env.AUTH0_DOMAIN,\n  clientId: process.env.AUTH0_CLIENTID,\n  clientSecret: process.env.AUTH0_CLIENTSECRET,\n  scope: 'openid profile',\n  redirectUri: process.env.AUTH0_REDIRECT_URI,\n  postLogoutRedirectUri: process.env.AUTH0_POSTLOGOUT_REDIRECT_URI,\n  session: {\n    cookieSecret: process.env.AUTH0_COOKIE_SECRET\n  }\n});\nexport default auth0;\nexport const isAuthorized = (user, role) => {\n  return user && user['https://kishonstclair.com' + '/roles'].includes(role);\n};\nexport const authorizeUser = async (req, res) => {\n  const session = await auth0.getSession(req);\n\n  if (!session || !session.user) {\n    res.writeHead(302, {\n      Location: '/api/v1/login'\n    });\n    res.end();\n    return null;\n  }\n\n  return session.user;\n};\nexport const withAuth = getData => role => async ({\n  req,\n  res\n}) => {\n  const session = await auth0.getSession(req);\n\n  if (!session || !session.user || role && !isAuthorized(data, role)) {\n    res.writeHead(302, {\n      Location: '/api/v1/login'\n    });\n    res.end();\n    return {\n      props: {}\n    };\n  }\n\n  const data = getData ? await getData({\n    req,\n    res\n  }, session.user) : {};\n  return {\n    props: _objectSpread({\n      user: session.user\n    }, data)\n  };\n};","map":{"version":3,"sources":["/Users/kishonst.clair/Desktop/PortfolioWebsite/kishon-portfolio-website/utils/auth0.js"],"names":["initAuth0","auth0","domain","process","env","AUTH0_DOMAIN","clientId","AUTH0_CLIENTID","clientSecret","AUTH0_CLIENTSECRET","scope","redirectUri","AUTH0_REDIRECT_URI","postLogoutRedirectUri","AUTH0_POSTLOGOUT_REDIRECT_URI","session","cookieSecret","AUTH0_COOKIE_SECRET","isAuthorized","user","role","includes","authorizeUser","req","res","getSession","writeHead","Location","end","withAuth","getData","data","props"],"mappings":";;;;;;AAAA,SAASA,SAAT,QAA0B,qBAA1B;AAKA,MAAMC,KAAK,GAAGD,SAAS,CAAC;AACtBE,EAAAA,MAAM,EAAEC,OAAO,CAACC,GAAR,CAAYC,YADE;AAEtBC,EAAAA,QAAQ,EAAEH,OAAO,CAACC,GAAR,CAAYG,cAFA;AAGtBC,EAAAA,YAAY,EAAEL,OAAO,CAACC,GAAR,CAAYK,kBAHJ;AAItBC,EAAAA,KAAK,EAAE,gBAJe;AAKtBC,EAAAA,WAAW,EAAER,OAAO,CAACC,GAAR,CAAYQ,kBALH;AAMtBC,EAAAA,qBAAqB,EAAEV,OAAO,CAACC,GAAR,CAAYU,6BANb;AAOtBC,EAAAA,OAAO,EAAE;AACPC,IAAAA,YAAY,EAAEb,OAAO,CAACC,GAAR,CAAYa;AADnB;AAPa,CAAD,CAAvB;AAYA,eAAehB,KAAf;AAEA,OAAO,MAAMiB,YAAY,GAAG,CAACC,IAAD,EAAOC,IAAP,KAAgB;AAC1C,SAAQD,IAAI,IAAIA,IAAI,CAAC,8BAA8B,QAA/B,CAAJ,CAA6CE,QAA7C,CAAsDD,IAAtD,CAAhB;AACD,CAFM;AAIP,OAAO,MAAME,aAAa,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC/C,QAAMT,OAAO,GAAG,MAAMd,KAAK,CAACwB,UAAN,CAAiBF,GAAjB,CAAtB;;AACA,MAAI,CAACR,OAAD,IAAY,CAACA,OAAO,CAACI,IAAzB,EAA+B;AAC7BK,IAAAA,GAAG,CAACE,SAAJ,CAAc,GAAd,EAAmB;AACjBC,MAAAA,QAAQ,EAAE;AADO,KAAnB;AAGAH,IAAAA,GAAG,CAACI,GAAJ;AACA,WAAO,IAAP;AACD;;AAED,SAAOb,OAAO,CAACI,IAAf;AACD,CAXM;AAaP,OAAO,MAAMU,QAAQ,GAAGC,OAAO,IAAIV,IAAI,IAAI,OAAO;AAACG,EAAAA,GAAD;AAAMC,EAAAA;AAAN,CAAP,KAAsB;AAC/D,QAAMT,OAAO,GAAG,MAAMd,KAAK,CAACwB,UAAN,CAAiBF,GAAjB,CAAtB;;AACA,MAAI,CAACR,OAAD,IAAY,CAACA,OAAO,CAACI,IAArB,IAA8BC,IAAI,IAAI,CAACF,YAAY,CAACa,IAAD,EAAOX,IAAP,CAAvD,EAAsE;AACpEI,IAAAA,GAAG,CAACE,SAAJ,CAAc,GAAd,EAAmB;AACjBC,MAAAA,QAAQ,EAAE;AADO,KAAnB;AAGAH,IAAAA,GAAG,CAACI,GAAJ;AACA,WAAO;AAACI,MAAAA,KAAK,EAAE;AAAR,KAAP;AACD;;AAED,QAAMD,IAAI,GAAGD,OAAO,GAAG,MAAMA,OAAO,CAAC;AAACP,IAAAA,GAAD;AAAMC,IAAAA;AAAN,GAAD,EAAaT,OAAO,CAACI,IAArB,CAAhB,GAA6C,EAAjE;AAEA,SAAO;AAACa,IAAAA,KAAK;AAAGb,MAAAA,IAAI,EAAEJ,OAAO,CAACI;AAAjB,OAA0BY,IAA1B;AAAN,GAAP;AACD,CAbM","sourcesContent":["import { initAuth0 } from '@auth0/nextjs-auth0';\n\n\n\n\nconst auth0 = initAuth0({\n  domain: process.env.AUTH0_DOMAIN,\n  clientId: process.env.AUTH0_CLIENTID,\n  clientSecret: process.env.AUTH0_CLIENTSECRET,\n  scope: 'openid profile',\n  redirectUri: process.env.AUTH0_REDIRECT_URI,\n  postLogoutRedirectUri: process.env.AUTH0_POSTLOGOUT_REDIRECT_URI,\n  session: {\n    cookieSecret: process.env.AUTH0_COOKIE_SECRET,\n  },\n});\n\nexport default auth0\n\nexport const isAuthorized = (user, role) => {\n  return (user && user['https://kishonstclair.com' + '/roles'].includes(role));\n}\n\nexport const authorizeUser = async (req, res) => {\n  const session = await auth0.getSession(req);\n  if (!session || !session.user) {\n    res.writeHead(302, {\n      Location: '/api/v1/login'\n    });\n    res.end();\n    return null;\n  }\n\n  return session.user;\n}\n\nexport const withAuth = getData => role => async ({req, res}) => {\n  const session = await auth0.getSession(req);\n  if (!session || !session.user || (role && !isAuthorized(data, role))) {\n    res.writeHead(302, {\n      Location: '/api/v1/login'\n    });\n    res.end();\n    return {props: {}};\n  }\n\n  const data = getData ? await getData({req, res}, session.user) : {};\n\n  return {props: {user: session.user, ...data}}\n}"]},"metadata":{},"sourceType":"module"}